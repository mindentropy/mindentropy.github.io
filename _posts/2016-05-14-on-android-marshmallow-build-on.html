---
layout: post
title: On Android Marshmallow build on Wandboard Dual
date: '2016-05-14T21:36:00.005+05:30'
author: Gautam Bhat
tags: 
modified_time: '2016-08-15T01:12:56.128+05:30'
blogger_id: tag:blogger.com,1999:blog-2655423030126048565.post-1722218212254757344
blogger_orig_url: https://thesoulofamachine.blogspot.com/2016/05/on-android-marshmallow-build-on.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">This post will be edited as and when I have progress. The final post will be structured for easy reading.<br /><br />I have upgraded my Ubuntu to 16.04 (Xenial) and I am having a host of problems compiling Marshmallow and the earlier Lollipop.<br /><br />In Marshmallow I was getting the "Unsupported reloc error 42". The fix for this is provided here <a href="https://android-review.googlesource.com/#/c/223100/">https://android-review.googlesource.com/#/c/223100/</a><br /><br />Update the makefile as above and build the kernel. Apart from that try to build using a smaller parallel job option i.e. -j5 for a quad core. I seemed to get the "JACK server could not start" which might be because of high memory usage. Also increasing the swap memory helps. I used to have a 1GB of swap for my 4GB laptop and I used to compiler errors because of out of memory. When multiple instances of JACK starts running there would almost 2GB + of swap memory usage!<br /><br />There is a problem with the SPL loader when the code is compiled using make. The board refuses to boot up. If the code is compiled manually i.e. ARCH=arm CROSS_COMPILE=prebuilts/gcc/linux-x86/arm/arm-eabi-4.8/bin/arm-eabi- make wandboard_defconfig etc. and I flash the SPL loader it boots. So this means there is something wrong with the compiler options used. Looking at the Makefile I find at line 974: BOOTLOADER_CROSS_TOOLCHAIN := `pwd`/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/bin/arm-linux-androideabi-<br /><br />The problem above is that the toolchain used is wrong. This is why it refused to boot. Changing it to what I was doing normally the board booted up.<br /><br />If you are using the OpenJDK 8 and you get Guava error as follows:<br /><br /><pre class="u-pre u-monospace MetadataMessage">external/guava/guava/src/com/google/common/reflect/Types.java:317:<br />error: TypeVariableImpl is not abstract and does not override abstract&nbsp;</pre><pre class="u-pre u-monospace MetadataMessage">method getAnnotatedBounds() in TypeVariable</pre><pre class="u-pre u-monospace MetadataMessage">&nbsp;private static final class&nbsp;</pre><pre class="u-pre u-monospace MetadataMessage">TypeVariableImpl&lt;D extends GenericDeclaration&gt;</pre><br />The following updated code by google offers the solution.<br /><a href="https://android.googlesource.com/platform/external/guava/+/1bc06418bcf6355136e8f774092eac49805623b6%5E%21/#">https://android.googlesource.com/platform/external/guava/+/1bc06418bcf6355136e8f774092eac49805623b6%5E%21/#</a><br /><br />Git clone it and checkout the commit id present in the link. Copy the Types.java file to the relevant place and start the compile.<br /><pre class="u-pre u-monospace MetadataMessage"></pre><h4 style="text-align: left;">Partitioning</h4><div style="text-align: left;">Partitioning is same as lollipop. In the first boot partition we have the following files:</div><ul style="text-align: left;"><li>u-boot.img</li><li>zImage</li><li>imx6q-wandboard.dtb</li><li>imx6dl-wandboard.dtb</li><li>uenv.txt</li><li>uramdisk.img</li></ul><br />The difference between lollipop and marshmallow for the wandboard is that the above files should be present in then root partition and not inside a separate /boot directory in the sdb1 partition.<br /><br />The above can be easily changed but since we are talking about the stock kernel from wandboard I will not deviate. <br /><br /></div>