---
layout: post
title: How to setup Linux on a MINI2440 development board
date: '2015-06-03T00:33:00.001+05:30'
author: Gautam Bhat
tags:
- mini2440
- technology
- linux
modified_time: '2016-02-01T01:40:21.538+05:30'
blogger_id: tag:blogger.com,1999:blog-2655423030126048565.post-3161080375826916931
blogger_orig_url: https://thesoulofamachine.blogspot.com/2015/06/how-to-setup-linux-on-mini2440.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">Assuming an ubuntu setup and with Pengutronix Linux kernel patches for the mini2440.<br /><br /><pre>RootFS creation using debian multistrap. See simple_config to create a simple <br />multistrap configuration.&nbsp;</pre><pre>&nbsp;</pre><pre>Use tar with the following options --&gt; -cpjvf --numeric-owner<br />-c --&gt; Create<br />-p --&gt; Preserve permissions<br />-j --&gt; bz2.<br />-v --&gt; verbose<br />-f --&gt; use file archive ie. the name of the file.<br /><br /><br />tar -cpjvf &lt;filename.tar.bz2&gt; . --numeric-owner<br /><br />Extraction is the same. Make sure you are using sudo as the file permissions usually&nbsp;</pre><pre>will have root user permissions and the permissions are preserved.<br /><br />Creation of a Emdebian rootfs.</pre><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3<br />4</pre></td><td><pre style="line-height: 125%; margin: 0;">sudo debootstrap --foreign --arch armel &lt;debian_release_codename&gt; &lt;rootfs_directory&gt; http://ftp.debian.org/debian/ Do -&gt; cp /usr/bin/qemu-static-arm &lt;rootfs_directory&gt;/usr/bin<br />Get a root environment. Do -&gt; sudo -i<br />To do a second stage install. Do -&gt; LC_ALL=C LANGUAGE=C LANG=C chroot debian_armel_wheezy /debootstrap/debootstrap --second-stage<br />To trigger post install scripts. Do -&gt; LC_ALL=C LANGUAGE=C LANG=C chroot emdebian_rootfs_wheezy_test dpkg --configure -a<br /></pre></td></tr></tbody></table></div><pre>&nbsp;</pre><pre></pre><pre>&nbsp;</pre><pre>Reference http://wiki.debian.org/EmDebian/CrossDebootstrap#QEMU.2Fdebootstrap_approach<br /><br />Copy fstab,udev.conf,udev.rules,ts.conf files from pengutronix to the rootfs sdcard.<br /><br /><b><u>Reference inittab</u></b></pre><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12</pre></td><td><pre style="line-height: 125%; margin: 0;">id:5:initdefault:<br /><br />T1::sysinit:/bin/mount -t proc proc /proc<br />T2::sysinit:/bin/mount -o remount,rw /<br />T3::sysinit:/bin/mkdir -p /dev/pts<br />T4::sysinit:/bin/hostname -F /etc/hostname<br /><br />T5::sysinit:/etc/init.d/rcS<br />T6::sysinit:/bin/mount -a<br />#T7::sysinit:/bin/mount -t sysfs sys /sys<br /><br />T0::respawn:/sbin/getty -L ttySAC0 38400 vt100<br /></pre></td></tr></tbody></table></div><pre></pre><pre></pre><pre></pre><pre></pre><pre></pre><pre></pre><pre></pre><pre><b><u>Reference passwd</u></b></pre><pre></pre><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3</pre></td><td><pre style="line-height: 125%; margin: 0;">root::0:0:root:/root:/bin/sh<br />bin:x:1:1:bin:/dev/null:/bin/false<br />nobody:x:99:99:Unprivileged user:/dev/null:/bin/false<br /></pre></td></tr></tbody></table></div><pre></pre><pre></pre><pre></pre><pre><b><u>Reference group</u></b></pre><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14</pre></td><td><pre style="line-height: 125%; margin: 0;">root:x:0<br />bin:x:1<br />nogroup:x:99<br />floppy:x:1000:<br />cdrom:x:1001:<br />tape:x:1002:<br />lp:x:1003:<br />tty:x:1004:<br />video:x:1005:<br />kmem:x:1006:<br />audio:x:1007:<br />disk:x:1008:<br />dialout:x:1009:<br />crontab:x:1010:<br /></pre></td></tr></tbody></table></div><pre></pre><pre></pre><pre></pre><pre></pre><pre><b><u>Reference fstab</u></b></pre><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12</pre></td><td><pre style="line-height: 125%; margin: 0;"># UNCONFIGURED FSTAB FOR BASE SYSTEM<br /><br />devpts /dev/pts devpts defaults  0 0<br />none /tmp   tmpfs defaults,mode=1777,uid=0,gid=0 0 0<br />none /sys   sysfs defaults   0 0<br />debugfs /sys/kernel/debug debugfs defaults   0 0<br />usbfs /proc/bus/usb  usbfs devgid=14,devmode=0660  0 0<br /><br />none /var/log  tmpfs defaults,mode=0755,uid=0,gid=0 0 0<br />none /run  tmpfs defaults,mode=0755,uid=0,gid=0 0 0<br />none /run/lock  tmpfs defaults,mode=0755,uid=0,gid=0 0 0<br />none /var/tmp  tmpfs defaults,mode=1777,uid=0,gid=0 0 0<br /></pre></td></tr></tbody></table></div><!-- HTML generated using hilite.me --> <br /><pre><u><b>/etc/securetty</b></u><br /><br />Add ttySAC0 entry at the end of securetty file.<br /><br />Copy relevant files like udev rules from pengutronix folders.<br /><br /><u><b>Kernel Compilation</b></u><br /><br />Get the kernel from kernel.org. If the patch from pengutronix is 3.9.1(i.e. patch.3.9.1.bz2) download the<br />3.9.0 kernel and the patch will patch the version to 3.9.1. Also if the patches directory shows 3.9 then <br />download the 3.9.0 kernel.<br /><br /><u><b>Using quilt to apply the 'series' patch.</b></u><br /><br />Create a sym link called patches pointing to&nbsp;</pre><pre>../OSELAS.BSP-Pengutronix-Mini2440/configs/platform-friendlyarm-mini2440/patches/linux-3.9/ in the<br />linux directory.<br />Create a sym link called series pointing to&nbsp;</pre><pre>../OSELAS.BSP-Pengutronix-Mini2440/configs/platform-friendlyarm-mini2440/patches/linux-3.9/series in<br />the linux directory.<br /><br />To apply the series of patches do -&gt; quilt push -av<br /><br />Copy kernelconfig to the defconfig</pre><pre>Eg: </pre><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1</pre></td><td><pre style="line-height: 125%; margin: 0;">cp ../OSELAS.BSP-Pengutronix-Mini2440/configs/platform-friendlyarm-mini2440/kernelconfig-3.9 arch/arm/configs/mini2440_defconfig<br /></pre></td></tr></tbody></table></div><pre><br /><u><b>Kernel compilation:</b></u>&nbsp;</pre><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2</pre></td><td><pre style="line-height: 125%; margin: 0;">CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm make mini2440_defconfig<br />CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm make menuconfig<br /></pre></td></tr></tbody></table></div><pre><u><b>Kernel config</b></u><br /><br />Device Drivers-&gt;Graphics Support-&gt;Bootup logo check.<br />        -&gt; Direct Rendering Manager.<br />        -&gt; Lowlevel video output switch controls.<br />         -&gt;Console display driver support -&gt; Framebuffer console support.<br />         Optional <br />          Framebuffer console rotation.<br />         Mini 4x6 font. (For smaller font).<br /><br />Device Drivers-&gt;Graphics Support-&gt;Support for framebuffer devices.<br />        -&gt; S3C2410 LCD framebuffer support.<br />        -&gt; S3C2410 lcd debug messages.<br /><br />Device Drivers-&gt;Character Devices-&gt;Enable TTY.<br />        -&gt; Virtual Terminal.<br />File Systems-&gt; Enable ext2,ext3<br />Network support -&gt; Networking support -&gt; IP: BOOTP support.<br />          IP: RARP support.<br /><br /><br /><!-- HTML generated using hilite.me --><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><br /><table><tbody><br /><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3</pre></td><td><pre style="line-height: 125%; margin: 0;">CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm  INSTALL_MOD_PATH=/mnt/arm make <br />CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm  INSTALL_MOD_PATH=/mnt/arm make uImage<br />CROSS_COMPILE=arm-linux-gnueabi- ARCH=arm  INSTALL_MOD_PATH=/mnt/arm make modules_install<br /></pre></td></tr></tbody></table></div><u><b>uboot options</b></u><b>:</b> <!-- HTML generated using hilite.me --><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2</pre></td><td><pre style="line-height: 125%; margin: 0;">bootargs=mini2440=5tb rootfstype=ext3 root=/dev/mmcblk0p2 rw bootdelay=rootwait ip=dhcp console=tty0 --&gt; For lcd console output.<br />bootargs=mini2440=5tb rootfstype=ext3 root=/dev/mmcblk0p2 rw bootdelay=rootwait ip=dhcp console=ttySAC0 --&gt; For serial output.<br /></pre></td></tr></tbody></table></div><u><b>Bootcmd for sdcard boot</b></u><b>:</b> <!-- HTML generated using hilite.me --><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1</pre></td><td><pre style="line-height: 125%; margin: 0;">bootcmd=mmcinit ; ext2load mmc 0:1 0x31000000 uImage ; bootm 0x31000000<br /></pre></td></tr></tbody></table></div><u><b>Bootcmd for tftpboot:</b></u> <!-- HTML generated using hilite.me --><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1</pre></td><td><pre style="line-height: 125%; margin: 0;">bootcmd=tftpboot 0x31000000 192.168.1.101:uImage ; bootm 0x31000000<br /></pre></td></tr></tbody></table></div><u><b>nfs setup</b></u>&nbsp;</pre><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3</pre></td><td><pre style="line-height: 125%; margin: 0;">mkdir /export<br />mkdir /export/fs<br />mkdir /export/kernel<br /></pre></td></tr></tbody></table></div><pre>&nbsp;</pre><pre><u><b>/etc/exports</b></u>&nbsp;</pre><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3</pre></td><td><pre style="line-height: 125%; margin: 0;">/export 192.168.1.0/24(rw,fsid=0,insecure,no_subtree_check,async)<br />/export/fs 192.168.1.0/24(rw,fsid=0,insecure,no_subtree_check,async,no_root_squash)<br />/export/kernel 192.68.1.0/24(rw,fsid=0,insecure,no_subtree_check,async)<br /></pre></td></tr></tbody></table></div><pre>&nbsp;</pre><pre><u><b>Bootcmd for nfs</b></u><br /><br /><!-- HTML generated using hilite.me --><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><br /><table><tbody><br /><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3<br />4<br />5</pre></td><td><pre style="line-height: 125%; margin: 0;">setenv bootcmd nfs 0x31000000 192.168.1.x:/nfs/rootfs/boot/uImage \; bootm<br />setenv bootargs console=ttySAC0,115200 root=/dev/nfs nfsroot\=192.168.1.x:/nfs/rootfs rw ip=dhcp mini2440=5tb<br />        |<br /><br />                                                                \----&gt; * Do not use environment variable * <br /></pre></td></tr></tbody></table></div></pre><pre>&nbsp;</pre><pre><u><b>NFS configuration which worked:</b></u><br /><br /><!-- HTML generated using hilite.me --><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><br /><table><tbody><br /><tr><td><pre style="line-height: 125%; margin: 0;">1</pre></td><td><pre style="line-height: 125%; margin: 0;">/nfs/rootfs 192.168.1.0/24(rw,fsid=0,insecure,no_subtree_check,async,no_root_squash)<br /></pre></td></tr></tbody></table></div>For ERROR cannot umount add mini2440 to /etc/hosts in your host.  For earlyprintk messages. Enable in the kernel. Also put a&nbsp;</pre><pre>'earlyprintk'(without quotes) in bootargs</pre><pre>&nbsp;</pre><pre>For eg: <!-- HTML generated using hilite.me --><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><br /><table><tbody><br /><tr><td><pre style="line-height: 125%; margin: 0;">1</pre></td><td><pre style="line-height: 125%; margin: 0;">setenv bootargs console=ttySAC0,115200 root=/dev/nfs nfsroot\=192.168.1.x:/nfs/rootfs rw ip=dhcp mini2440=5tb earlyprintk<br /></pre></td></tr></tbody></table></div></pre></div>