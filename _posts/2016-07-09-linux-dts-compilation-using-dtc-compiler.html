---
layout: post
title: Linux dts compilation using dtc compiler.
date: '2016-07-09T00:57:00.003+05:30'
author: Gautam Bhat
tags: 
modified_time: '2016-07-16T12:11:44.957+05:30'
blogger_id: tag:blogger.com,1999:blog-2655423030126048565.post-2677630530693210521
blogger_orig_url: https://thesoulofamachine.blogspot.com/2016/07/linux-dts-compilation-using-dtc-compiler.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">I was reading up on the dts (<b>D</b>evice <b>T</b>ree <b>S</b>pecification) specification and wanted to try out custom dts and compile it to dtb (<b>D</b>evice <b>T</b>ree <b>B</b>lob).<br /><br />The dts I wanted to compile was for the Wandboard which is the imx6dl-wandboard.dts<br /><br />To compile I use the following command:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;">dtc -I dts -O dtb -o imx6dl-wandboard_test.dts<br /></pre></div><br />When trying this I get the error <i>"FATAL ERROR: Unable to parse input tree near the includes..."</i><br /><br />Turns out we have to use CPP (C Preprocessor)&nbsp; to parse the includes and substitutions. Hence the next command is as follows:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;">cpp -nostdinc -I include -undef, -x assembler-with-cpp imx6dl-wandboard.dts &gt; imx6dl-wandboard_bare.dts<br /></pre></div><br />&nbsp;Here we use<br /><br />-nostdinc:&nbsp; We do not search system directories for header files. Only the directories I have specified wtih the -I are searched for header files.<br /><br />-undef: We do not perform any system-specific or GCC-specific macros. All standard predefined macros remain definied.<br /><br />-x: We provide the option assembler-with-cpp as the dtc compiler cannot auto ditacte whether the file is a "open", "clode", "read and write"<br /><br />Pass the dts file and redirect the output to an output dts file.<br />Next we run the dtc compiler as above replacing imx6dl-wandboard_test.dts with the output generated from CPP. This will create the dtb file . You reverse the dtb to a dts by replacing the -I parameter with dtb and -O parameter with dts.<br /><br />Also make sure you run this command in the arch/arm/boot/dts directory because of the includes present in it. Replace the "arm" with your CPU architecture of choice.<br /><br />Additionally you can also create the dtb file running the rule dtbs in the makefile.<br /><br />To make it work edit the Makefile in the arch/arm/boot/dts and add your dts file in the proper architecture. For my wandboard it will be dtb-$(CONFIG_ARCH_MXC).<br /><br />Next create the dtb file with the following command:<br /><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1</pre></td><td><pre style="line-height: 125%; margin: 0;">ARCH=arm CROSS_COMPILE=`pwd`/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/bin/arm-linux-androideabi- make -C kernel_imx/ dtbs<br /></pre></td></tr></tbody></table></div><br /><br /><br />References: <a href="https://linux-sunxi.org/Device_Tree#Compiling_the_Device_Tree">https://linux-sunxi.org/Device_Tree#Compiling_the_Device_Tree</a><br /><br /><div style="text-align: center;"><i><b>"There must be no barriers to freedom of inquiry â€¦ There is no place for dogma in science. The scientist is free, and must be free to ask any question, to doubt any assertion, to seek for any evidence, to correct any errors."</b></i></div><div style="text-align: center;"><i><b>--J Robert Oppenheimer </b></i></div><br /><br /><br /></div>