---
layout: post
title: Android Lollipop build and install on Wandboard Dual
date: '2015-12-17T03:04:00.002+05:30'
author: Gautam Bhat
tags:
- wandboard
- android
modified_time: '2016-05-25T19:19:11.823+05:30'
blogger_id: tag:blogger.com,1999:blog-2655423030126048565.post-9136421668228631736
blogger_orig_url: https://thesoulofamachine.blogspot.com/2015/12/android-lollipop-build-and-install-on.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">I took a small break from baremetal development to learn some Android. I had bought a Wandboard Dual for the purpose of learning Android. This board comes with the Freescale i.MX6 Cortex A9 Dual core CPU with 1GB of DDR3 RAM.<br /><br /><br /><u>My Build setup</u>:<br /><br />Ubuntu 15.10 Wily<br />Sun java version "1.8.0_51" and javac 1.8.0_51<br /><br />Do a prerequisite install of the different packages as mentioned in google android site.<br /><br />As I recall there was a problem when the kernel was getting archived which seems to be because of <b>lzop</b> package not being present. It seems to be the latest way to archive. Please install the package from the repository.<br /><br /><br />Coming to the install grab the Android Lollipop source archive from the Wandboard site and unzip it.<br /><br /><br /><br />Modify  wandboard.h(bootable/bootloader/uboot-imx/include/configs/wandboard.h)  to have the appropriate display resolution. I have a Dell Monitor with  1920x1024@60 as ideal specification.<br />So my code snippet is:<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;">  <span style="color: #aa5500;">"if hdmidet; then "</span> \<br />            <span style="color: #aa5500;">"setenv bootargs ${bootargs} "</span> \<br /><br />                <span style="color: #aa5500;">"video=mxcfb${nextcon}:dev=hdmi,1920x1080M@60,"</span> \<br />                    <span style="color: #aa5500;">"if=RGB24; "</span> \<br />            <span style="color: #aa5500;">"setenv fbmen fbmem=28M; "</span> \<br /></pre></div><br />Either  compile first and then modify and compile again or modify the above in  the initial steps before start of compilation and then compile.<br /><br />Now do a <br /><ol style="text-align: left;"><li>source ./build/envsetup.sh</li><li>lunch and hit tab to see the options. Do -&gt; lunch wandboard-eng</li><li>make -j10 (here 10 is because I have a quad core machine. So the rule being 2.5 * number of cores we get 2.5 * 4 = 10)</li></ol>In between the build might stop because of changes in Java code where they have introduced constants which are not present in the original AOSP. The build suggests running make update_api. So do a make update_api and then again start by doing make -j10.<br /><br />There might be errors when compilation of u-boot and it might stop. Restart the compilation again. This time there will be no stoppage. <br /><br />My build took at least 3 hours to complete! Usage of CCACHE is highly recommended.<br /><br /><u>Partition of SD Card</u>:<br /><br />I created the following partition on my SD card using gparted as the fsl-sdcard-partitions.sh (present in ./device/fsl/common/tools) does not work because of "unsupported option -M" in the recent version of sfdisk.<br /><br />My partition structure is as follows:<br /><br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;">Disk /dev/sdb: 29.7 GiB, 31914983424 bytes, 62333952 sectors<br />Units: sectors of 1 * 512 = 512 bytes<br />Sector size (logical/physical): 512 bytes / 512 bytes<br />I/O size (minimum/optimal): 512 bytes / 512 bytes<br />Disklabel type: dos<br />Disk identifier: 0x74ea21b6<br /><br />Device&nbsp;&nbsp;&nbsp;&nbsp; Boot&nbsp;&nbsp;&nbsp; Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End&nbsp; Sectors&nbsp; Size Id Type<br />/dev/sdb1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 206848&nbsp;&nbsp; 309247&nbsp;&nbsp; 102400&nbsp;&nbsp; 50M&nbsp; b W95 FAT32<br />/dev/sdb2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 309248&nbsp; 1357823&nbsp; 1048576&nbsp; 512M 83 Linux<br />/dev/sdb3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1357824 33310719 31952896 15.2G&nbsp; 5 Extended<br />/dev/sdb4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 33310720 62332927 29022208 13.9G 83 Linux<br />/dev/sdb5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1359872 11845631 10485760&nbsp;&nbsp;&nbsp; 5G 83 Linux<br />/dev/sdb6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11847680 16041983&nbsp; 4194304&nbsp;&nbsp;&nbsp; 2G 83 Linux<br />/dev/sdb7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16044032 18141183&nbsp; 2097152&nbsp;&nbsp;&nbsp; 1G 83 Linux<br />/dev/sdb8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 18143232 22337535&nbsp; 4194304&nbsp;&nbsp;&nbsp; 2G 83 Linux<br />/dev/sdb9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 22339584 33310719 10971136&nbsp; 5.2G 83 Linux</div><br />Here<br /><ol style="text-align: left;"><li>sdb1 is BOOT which is a vfat partition.</li><li>sdb2 is RECOVERY. All partitions including this will be ext4.</li><li>sdb3 will be an extended partition as we can hold maximum of 4 primary partitions.</li><li>sdb4 is DATA </li><li>sdb5 is SYSTEM</li><li>sdb6 is CACHE</li><li>sdb7 is DEVICE</li><li>sdb8 is MISC</li><li>sdb9 will be mounted if encryptable to sdb5 data.</li></ol><br />Leave at least 100MB space at the start of the SD Card for the UBoot SPL loader.<br /><br />After the build is done we have to flash the SD card.<br /><br />In the below command we seek 1KB. This is done because Image Vector table offset is 0x400 or 1KB from the start. (Ref: Processor Reference Manual Pg 434).<br /><br />sudo dd if=bootable/bootloader/uboot-imx/SPL of=/dev/sdb bs=1K seek=1; sync<br /><br />sudo dd if=./out/target/product/wandboard/system.img of=/dev/sdb5; sync<br /><br />sudo mount /dev/sdb1 /mnt/wandboard<br />cd /mnt/wandboard<br />mkdir boot<br /><br /><br />For initial ramdisk image creation please do the following:<br />mkimage -A arm -O linux -T ramdisk -C none -a 0x10800800 -n "Android  Root Filesystem" -d out/target/product/wandboard/ramdisk.img  /mnt/wandboard/boot/uramdisk.img<br /><pre>&nbsp;</pre>Copy the following files to the boot directory:<br /><br />kernel_imx/arch/arm/boot/dts/imx6dl-wandboard.dtb,device/fsl/wandboard/logo/out.bmp.gz,bootable/bootloader/uboot-imx/u-boot.img,device/fsl/wandboard/uenv/uEnv.txt,kernel_imx/arch/arm/boot/uImage and kernel_imx/arch/arm/boot/zImage.<br /><br />Modify uEnv.txt to have the following text:<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;">bootargs_base=console=ttymxc0,115200 init=/init androidboot.console=ttymxc0 androidboot.hardware=freescale vmalloc=400M androidboot.selinux=disabled<br />video_mode=display0=dev=hdmi,mode=1920x1080M@60,if=RGB24,bpp=32 fbmem=28M<br />expansion=fwbadapt<br />baseboard=wand<br /></pre></div><br /><br />Insert the SD Card in the wandboard. Make sure you have connected the display and then boot.<br /><br />You should get a "android" in the boot screen. After this you will get "Updating apps" dialog and then you will get the standard Android launcher screen.<br /><br />That is all. I will update this HOWTO if I have missed anything.<br /><br /><br /></div>