---
layout: post
title: Binder driver protocol does not match user space protocol
date: '2019-01-31T11:46:00.003+05:30'
author: Gautam Bhat
tags: 
modified_time: '2019-01-31T11:46:55.948+05:30'
blogger_id: tag:blogger.com,1999:blog-2655423030126048565.post-4649612508042980243
blogger_orig_url: https://thesoulofamachine.blogspot.com/2019/01/binder-driver-protocol-does-not-match.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><span style="font-family: Verdana, sans-serif;">After updating my Kernel 4.4 branch and also Android repo syncing of Nougat I started getting Binder driver protocol does not match user space protocol.</span><br /><span style="font-family: Verdana, sans-serif;"><br /></span><span style="font-family: Verdana, sans-serif;">Log of my work follows:</span><br /><span style="font-family: Verdana, sans-serif;"><br /></span><ol style="text-align: left;"><li><span style="font-family: Verdana, sans-serif;">Updating kernel headers in bionic is the first step which was highlighted in my previous post</span></li><li><span style="font-family: Verdana, sans-serif;">Next I started snooping around and found that frameworks/libs/binder/ProcessState.cpp checks the version and then fails</span></li><li><span style="font-family: Verdana, sans-serif;">I wrote a simple C program to check what version the binder driver and the ioctl responds with Version 8</span></li><li><span style="font-family: Verdana, sans-serif;">Next I check the kernel headers and find that there is a version switch when BINDER_IPC_32BIT is defined or something else possibly BINDER_IPC_64BIT Ref: https://elixir.bootlin.com/linux/v4.4/source/include/uapi/linux/android/binder.h#L43 and https://elixir.bootlin.com/linux/v4.4/source/include/uapi/linux/android/binder.h#L94</span></li><li><span style="font-family: Verdana, sans-serif;">Changed it in the source external/kernel-headers/original/....../binder.h and commented out the BINDER_IPC_32BIT and kept only the 64 bit. This is because the kernel has moved on to 64 bit and there is no support for 32 bit. Due to this the KConfig variable is removed. I have still experiment by manually modifying the .config variable</span></li><li><span style="font-family: Verdana, sans-serif;">Ran tools/update_all.py and finally rebuilt the whole AOSP.&nbsp;</span></li></ol><span style="font-family: Verdana, sans-serif;">These steps finally&nbsp; fixed all the issues related to binder.</span><br /><br /><span style="font-family: Verdana, sans-serif;">Next step is to fix the hwcomposer not found issue. Let us see how that goes. </span></div>