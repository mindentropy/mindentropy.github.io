---
layout: post
title: Creating a bootscript file for u-boot
date: '2018-01-16T18:31:00.001+05:30'
author: Gautam Bhat
tags: 
modified_time: '2018-06-07T00:57:25.432+05:30'
blogger_id: tag:blogger.com,1999:blog-2655423030126048565.post-1497017519012301653
blogger_orig_url: https://thesoulofamachine.blogspot.com/2018/01/creating-bootscript-file-for-u-boot.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">I have created a boot script file to boot my Beaglebone via tftp. I did not want to change the default boot configuration in the headers as it would add changes to my u-boot code which would deviate from the mainline.<br /><br />First we create a file called boot.cmd. I have the following in my boot.cmd file which can be reused.<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10</pre></td><td><pre style="line-height: 125%; margin: 0;">setenv bootargs console=${console} root=/dev/mmcblk0p2 rootfstype=ext4 rw rootwait<br />setenv fdtaddr 0x8C008000<br />setenv loadaddr 0x80008000<br />run findfdt<br />setenv tftp_fdt tftp ${fdtaddr} ${fdtfile}<br />setenv tftp_uimage tftp ${loadaddr} uImage<br />setenv sd_fdt fatload mmc 0:1 ${fdtaddr} ${fdtfile}<br />setenv sd_uimage fatload mmc 0:1 ${loadaddr} uImage<br />setenv tftpboot 'run tftp_fdt; run tftp_uimage; bootm ${loadaddr} - ${fdtaddr}'<br />setenv sdboot 'run sd_fdt; run sd_uimage; bootm ${loadaddr} - ${fdtaddr}'<br /></pre></td></tr></tbody></table></div><br /><br />We change this to boot.scr file by doing the following:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1</pre></td><td><pre style="line-height: 125%; margin: 0;">mkimage -C none -A arm -T script -d boot.cmd boot.scr<br /></pre></td></tr></tbody></table></div><br />We keep this boot.scr in the first partition. We reset/reboot/boot the board and then we do the following:<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3<br />4<br />5</pre></td><td><pre style="line-height: 125%; margin: 0;">fatload mmc 0:1 0x80000000 boot.scr<br />source 0x80000000<br />setenv serverip &lt;yourtftp ip address&gt;<br />setenv ipaddr &lt;yourbeagleboneip&gt;<br />run tftpboot<br /></pre></td></tr></tbody></table></div><br />Basically the above would load the boot.scr file in 0x80000000 location and run the script from that location by doing a run &lt;memory_address&gt;.<br /><br />I will improve on this script a little bit and will keep updating this blog post.</div>